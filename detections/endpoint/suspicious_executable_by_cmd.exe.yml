id: '8823.15735'
title: Suspicious Executable by CMD.exe
description: 'Detect when an executable has been launched by cmd.exe. Such as spawning
  powershell.exe, cscript rundll32 and similar processes being a child process of
  cmd. -- Threat Actor Association: APT28 (aka.Fancy Bear, Fighting Ursa, Forest Blizzard,
  Pawn Storm, TA422, STRONTIUM), APT34/OilRig, APT43, FIN8, Flax Typhoon, REvil, WinterVivern/UAC-0114
  - Software Association: Alchimist, AvosLocker, Black Basta, MagicRAT, Rhysida'
logic_format: Splunk
logic: '| avlsearchrest rest_name=devo query="from edr.cbef.endpoint_event.procstart
  where (weaktoktains(rawMessage,''EventCode=4688'') or weaktoktains(rawMessage,''<EventID>4688<'')
  or weaktoktains(rawMessage,''Type=Process'') or (has(rawMessage,''ACTION'') and
  has(rawMessage,''PROCESS''))) and weaktoktains(rawMessage,''cmd.exe'') and (weaktoktains(rawMessage,''powershell.exe'')
  or weaktoktains(rawMessage,''services.exe'') or weaktoktains(rawMessage,''dllhost.exe'')
  or weaktoktains(rawMessage,''rundll32.exe'') or weaktoktains(rawMessage,''cscript.exe''))"
  `map_endpoint_edr` | regex parent_process_name="(?i)(cmd\.exe)" | regex process_path="(?i)((powershell)|(services)|(dllhost)|(rundll32)|(cscript))\.exe"
  | table _time, host, user event_id, parent_*, process_*, process, signature_id,
  src_*, dest_* | bin span=1s | stats values(*) as * by _time, host | where isnotnull(user)
  `hec_collect`'
techniques:
- execution:command and scripting interpreter
technique_id: null
data_category:
- EDR Logs
- Process command-line parameters
references:
- https://secure.anvilogic.com/use_cases?id=AVL_UC1041#more_info
