id: '33015.58557'
title: CVE-2024-4577 - PHP CGI Argument Injection vulnerability
description: In PHP versions 8.1.* before 8.1.29, 8.2.* before 8.2.20, 8.3.* before
  8.3.8, when using Apache and PHP-CGI on Windows, if the system is set up to use
  certain code pages, Windows may use "Best-Fit" behavior to replace characters in
  command line given to Win32 API functions. PHP CGI module may misinterpret those
  characters as PHP options, which may allow a malicious user to pass options to PHP
  binary being run, and thus reveal the source code of scripts, run arbitrary PHP
  code on the server, etc. This use case detects when a soft hyphen has been used
  along with either a PHP option to modify the INI file, or a PHP opening tag in a
  POST request.
logic_format: Splunk
logic: '`get_web_data` `get_web_data_waf` http_method=POST "%AD" ("<?php" OR "allow_url_include"
  OR "auto_prepend_file") | table _time, host, user, _time, host, uri_path, uri_query,
  src_ip, dest_ip | bin span=1s | stats values(*) as * by _time, dest_ip | lookup
  dnslookup clientip as src_ip OUTPUT clienthost as src_dns | iplocation prefix="src_"
  src_ip | rename src_Country as src_country '
techniques:
- execution:command and scripting interpreter
- initial-access:exploit public-facing application
technique_id: 
- T1059
- T1190
data_category:
- Web application firewall logs
references:
- https://github.com/watchtowrlabs/CVE-2024-4577
- https://labs.watchtowr.com/no-way-php-strikes-again-cve-2024-4577/
