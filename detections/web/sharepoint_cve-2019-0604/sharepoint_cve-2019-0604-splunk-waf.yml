id: '1099.1158'
title: SharePoint CVE-2019-0604
description: Detect SharePoint CVE-2019-0604 exploit, which may lead to remote code
  execution.
logic_format: Splunk
logic: '`get_web_data` `get_web_data_waf` (("Microsoft.SharePoint.WebControls.ItemPickerDialog"
  OR "Microsoft.SharePoint.Portal.WebControls.ItemPickerDialog") OR (uri_path IN (TERM(/_layouts/15/Picker.aspx),TERM(/_layouts/15/ua.aspx))))
  AND http_method=POST | regex src_content="^\_\_"| rex field=src_content "(?i)(?<break_point_indicator>^__)"
  | table _time, host, user, dest_ip, uri_path, status, src_ip, http_user_agent http_method
  break_point_indicator uri_query | bin span=1s | stats values(*) as * by _time, dest_ip
  | lookup dnslookup clientip as src_ip OUTPUT clienthost as src_dns | iplocation
  prefix="src_" src_ip | rename src_Country as src_country `hec_collect` '
techniques:
- execution:exploitation for client execution
technique_id: 
- T1203
data_category:
- Web application firewall logs
references:
- https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0604
